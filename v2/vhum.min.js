/***vhum.v2-verificador.de.humanos-icaro.wzeronine***/class HumanVerifier{constructor(t,e,s=5){this.checkboxElement=t,this.displayElement=e,this.isTracking=!1,this.dataObject={},this.moveEvents=[],this.touchEndBlock=0,this.BLOCK_DURATION=300,this.moveSampleRate=s,this.moveCounter=0,this.attachListeners(),this.setupInitialState()}setupInitialState(){this.deviceInfo={userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,pixelRatio:window.devicePixelRatio||1,touchSupport:"ontouchstart"in window||navigator.maxTouchPoints>0}}getTouchData(t){if(!t.changedTouches||0===t.changedTouches.length)return null;const{clientX:e,clientY:s,force:i,target:a}=t.changedTouches[0];return{x:Math.round(e),y:Math.round(s),timestamp:Date.now(),pressure:i||null,target:a.id||a.tagName}}getMouseData(t){const{clientX:e,clientY:s,target:i}=t;return{x:Math.round(e),y:Math.round(s),timestamp:Date.now(),target:i.id||i.tagName}}handleTouchStart=t=>{if(this.isTracking)return;this.touchEndBlock=0,this.isTracking=!0;const e=Date.now();this.moveEvents=[],this.moveCounter=0,this.dataObject={type:"TOUCH",startTimestamp:e,endTimestamp:null,touchStart:this.getTouchData(t),touchEnd:null,moveEvents:this.moveEvents,deviceInfo:this.deviceInfo}};handleTouchMove=t=>{if(!this.isTracking||"TOUCH"!==this.dataObject.type)return;if(this.moveCounter++,this.moveCounter%this.moveSampleRate!=0)return;const e=this.getTouchData(t);e&&this.moveEvents.push(e)};handleTouchEnd=t=>{if(!this.isTracking||"TOUCH"!==this.dataObject.type)return;this.isTracking=!1,this.touchEndBlock=Date.now()+this.BLOCK_DURATION,this.dataObject.endTimestamp=Date.now();let e=this.getTouchData(t);!e&&this.dataObject.touchStart&&(e={...this.dataObject.touchStart,timestamp:this.dataObject.endTimestamp}),this.dataObject.touchEnd=e,this.dataObject.duration=this.dataObject.endTimestamp-this.dataObject.startTimestamp,this.dataObject.metrics={totalMoveEvents:this.moveCounter,sampledMoveEvents:this.moveEvents.length},this.sendDataToServer(this.dataObject),this.resetState()};handleMouseDown=t=>{if(Date.now()<this.touchEndBlock)return void t.preventDefault();if(0!==t.button||this.isTracking)return;this.isTracking=!0;const e=Date.now();this.moveEvents=[],this.moveCounter=0,this.dataObject={type:"MOUSE",startTimestamp:e,endTimestamp:null,mouseDown:this.getMouseData(t),mouseUp:null,moveEvents:this.moveEvents,initialCheckboxState:this.checkboxElement.checked,deviceInfo:this.deviceInfo}};handleMouseMove=t=>{if(!this.isTracking||"MOUSE"!==this.dataObject.type)return;if(this.moveCounter++,this.moveCounter%this.moveSampleRate!=0)return;const e=this.getMouseData(t);this.moveEvents.push(e)};handleMouseUp=t=>{Date.now()<this.touchEndBlock||this.isTracking&&"MOUSE"===this.dataObject.type&&(this.isTracking=!1,this.dataObject.endTimestamp=Date.now(),this.dataObject.mouseUp=this.getMouseData(t),this.dataObject.duration=this.dataObject.endTimestamp-this.dataObject.startTimestamp,this.dataObject.finalInteraction={...this.getMouseData(t),finalCheckboxState:this.checkboxElement.checked},this.dataObject.metrics={totalMoveEvents:this.moveCounter,sampledMoveEvents:this.moveEvents.length},this.sendDataToServer(this.dataObject),this.resetState())};resetState(){this.dataObject={},this.moveEvents=[],this.isTracking=!1}sendDataToServer(t){this.displayElement.textContent=JSON.stringify(t,null,2)}attachListeners(){this.checkboxElement.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),this.checkboxElement.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),this.checkboxElement.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),this.checkboxElement.addEventListener("mousedown",this.handleMouseDown,{passive:!0}),document.addEventListener("mousemove",this.handleMouseMove,{passive:!0}),document.addEventListener("mouseup",this.handleMouseUp,{passive:!0}),this.checkboxElement.addEventListener("change",(()=>{this.checkboxElement.checked||(this.resetState(),this.displayElement.textContent="")}))}}